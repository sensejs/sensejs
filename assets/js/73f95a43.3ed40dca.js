"use strict";(self.webpackChunk_sensejs_sensejs_doc=self.webpackChunk_sensejs_sensejs_doc||[]).push([[612],{258:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>c,toc:()=>r});var t=o(5250),d=o(9074);const s={id:"defining-modules",sidebar_position:1},i="Defining Modules",c={id:"module/defining-modules",title:"Defining Modules",description:"The most simple way to define a module is to call createModule function.",source:"@site/docs/module/defining-modules.md",sourceDirName:"module",slug:"/module/defining-modules",permalink:"/docs/module/defining-modules",draft:!1,unlisted:!1,editUrl:"https://github.com/sensejs/sensejs/edit/master/website/docs/module/defining-modules.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"defining-modules",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Module",permalink:"/docs/module/"},next:{title:"Entry point",permalink:"/docs/module/entrypoint"}},l={},r=[{value:"Lifecycle hooks",id:"lifecycle-hooks",level:2},{value:"Inter-module dependency",id:"inter-module-dependency",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,d.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"defining-modules",children:"Defining Modules"}),"\n",(0,t.jsxs)(n.p,{children:["The most simple way to define a module is to call ",(0,t.jsx)(n.code,{children:"createModule"})," function."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const MyModule = createModule({\n  requires: [],   // Other modules that are required by this module\n  components: [], // Component injectable provided by this module\n  factories: [],  // Dynamic injectable provided by this module\n  constants: [],  // Constant injectables provided by this module\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"Usually, you define a module in this way when it only exports injectables."}),"\n",(0,t.jsx)(n.p,{children:"When you need to use some advanced features of module, such as lifecycle hooks, you need to define a module with\ndecorator-style."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@Module({\n    requires: [],\n    components: [],\n    factories: [],\n    constants: [],\n})\nclass MyModule {\n\n    constructor(@InjectLogger() logger: Logger) {\n      logger.log('Hello from constructor of MyModule');\n    }\n\n    @OnModuleCreated()\n    onModuleCreated(@InjectLogger() logger: Logger) {\n      logger.info('Hello from onModuleCreated of MyModule');\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"lifecycle-hooks",children:"Lifecycle hooks"}),"\n",(0,t.jsx)(n.p,{children:"SenseJS defined four lifecycle hooks for modules. Just like the module constructor, the parameters of these lifecycle\nhooks are automatically injected by the framework."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"OnModuleCreated"}),"/",(0,t.jsx)(n.code,{children:"OnModuleDestroy"}),": called when the module is created/destroyed, respectively."]}),"\n",(0,t.jsxs)(n.p,{children:["When one of your components needs to be initialized and de-initialized(such component must be singleton scoped),\nit shall be done in the ",(0,t.jsx)(n.code,{children:"@OnModuleCreated"})," and ",(0,t.jsx)(n.code,{children:"@OnModuleDestroy"})," hooks of the module that provides the component."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"\n@Component({scope: ComponentScope.SINGLETON})\nexport class DatabaseConnection {\n    async connect() { }\n    async disconnect() { }\n    async query() { }\n}\n\n@Module({components: [DatabaseConnection]})\nexport class DatabaseModule {\n\n    @OnModuleCreated()\n    async onCreated(@Inject(DatabaseConnection) conn) {\n        await conn.connect();\n    }\n\n    @OnModuleDestroy()\n    async onDestroyed(@Inject(DatabaseConnection) conn) {\n        await conn.disconnect();\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["So that ",(0,t.jsx)(n.code,{children:"DatabaseConnection"})," is ensured to be connected before it can be used outside of ",(0,t.jsx)(n.code,{children:"DatabaseModule"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"OnModuleStart"}),"/",(0,t.jsx)(n.code,{children:"OnModuleStop"}),": When a module is designed to handle requests, the initialization and\nde-initialization needs to be done in ",(0,t.jsx)(n.code,{children:"@OnModuleStart"})," and ",(0,t.jsx)(n.code,{children:"@OnModuleStop"})," hooks."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@Module()\nclass TcpEchoServerModule {\n    tcpServer?: net.Server;\n\n    @OnModuleStart()\n    async onCreated() {\n        this.tcpServer = net.createServer((conn)=> conn.pipe(conn)).listen(3000);\n    }\n\n    @OnModuleStop()\n    async onDestroyed() {\n        if (this.tcpServer) {\n            this.tcpServer.close();\n        }\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"OnModuleStart"})," hooks are ensured to be invoked after all ",(0,t.jsx)(n.code,{children:"OnModuleCreated"})," hooks are finished for all modules,\nwhile ",(0,t.jsx)(n.code,{children:"OnModuleDestroy"})," hooks are ensured to be finished before any invocation to ",(0,t.jsx)(n.code,{children:"OnModuleDestroy"})," hooks. This is\nhow SenseJS gracefully startup and shut down your app."]}),"\n",(0,t.jsxs)(n.p,{children:["Note that ",(0,t.jsx)(n.code,{children:"OnModuleStart"}),"/",(0,t.jsx)(n.code,{children:"OnModuleStop"})," hooks will be triggered only when the module is started by\n",(0,t.jsx)(n.code,{children:"ApplicationRunner.start"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"inter-module-dependency",children:"Inter-module dependency"}),"\n",(0,t.jsxs)(n.p,{children:["To control the initialization and de-initialization order, you need to specify which one depends on the other ones.\nThis is done by listing the dependent module in ",(0,t.jsx)(n.code,{children:"requires"})," property of the module definition."]}),"\n",(0,t.jsx)(n.p,{children:"The following example shows how the need of controlling the initialize order, and how to specify the dependency."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@Module({\n\n  requires: [DatabaseModule],\n})\nclass SomeFancyModule {\n\n\n  @OnModuleCreated()\n  async onModuleCreated(@Inject(DatabaseConnection) conn: DatabaseConnection) {\n    // Reload state from the database\n    // ...\n  }\n\n  @OnModuleDestroy()\n  async onModuleDestroy(@Inject(DatabaseConnection) conn: DatabaseConnection) {\n    // Persist state to the database\n    // ...\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["In the above code, ",(0,t.jsx)(n.code,{children:"SomeFancyModule"})," need to inject an instance of ",(0,t.jsx)(n.code,{children:"DatabaseConnection"}),", which is defined in\n",(0,t.jsx)(n.code,{children:"DatabaseModule"}),", during its ",(0,t.jsx)(n.code,{children:"OnModuleCreated"})," and ",(0,t.jsx)(n.code,{children:"OnModuleDestroy"})," hooks. So it is necessary to specify\n",(0,t.jsx)(n.code,{children:"DatabaseModule"})," in ",(0,t.jsx)(n.code,{children:"requires"})," property, otherwise the ",(0,t.jsx)(n.code,{children:"DatabaseConnection"})," may not be available when ",(0,t.jsx)(n.code,{children:"SomeFancyModule"}),"\nis created or destroyed."]}),"\n",(0,t.jsx)(n.p,{children:"Note that once a module is initialized, any injectable provided by one module will be available to others, even\ncomponents from the other modules that do not list it as a dependency."}),"\n",(0,t.jsx)(n.p,{children:"In other words, the inter-module dependency graph only affects the order of initialization and de-initialization but\ndoes not restrict you from injecting anything from any other module."}),"\n",(0,t.jsx)(n.p,{children:"Anyway, it is a good practice to explicitly specify the relationship between modules."})]})}function u(e={}){const{wrapper:n}={...(0,d.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},9074:(e,n,o)=>{o.d(n,{Z:()=>c,a:()=>i});var t=o(79);const d={},s=t.createContext(d);function i(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);