"use strict";(self.webpackChunk_sensejs_sensejs_doc=self.webpackChunk_sensejs_sensejs_doc||[]).push([[612],{4852:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>y});var o=t(9231);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var d=o.createContext({}),s=function(e){var n=o.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},c=function(e){var n=s(e.components);return o.createElement(d.Provider,{value:n},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},m=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,d=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=s(t),m=a,y=p["".concat(d,".").concat(m)]||p[m]||u[m]||i;return t?o.createElement(y,r(r({ref:n},c),{},{components:t})):o.createElement(y,r({ref:n},c))}));function y(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,r=new Array(i);r[0]=m;var l={};for(var d in n)hasOwnProperty.call(n,d)&&(l[d]=n[d]);l.originalType=e,l[p]="string"==typeof e?e:a,r[1]=l;for(var s=2;s<i;s++)r[s]=t[s];return o.createElement.apply(null,r)}return o.createElement.apply(null,t)}m.displayName="MDXCreateElement"},2165:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var o=t(6e3),a=(t(9231),t(4852));const i={id:"defining-modules",sidebar_position:1},r="Defining Modules",l={unversionedId:"module/defining-modules",id:"module/defining-modules",title:"Defining Modules",description:"The most simple way to define a module is to call createModule function.",source:"@site/docs/module/defining-modules.md",sourceDirName:"module",slug:"/module/defining-modules",permalink:"/docs/module/defining-modules",draft:!1,editUrl:"https://github.com/sensejs/sensejs/edit/master/website/docs/module/defining-modules.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"defining-modules",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Module",permalink:"/docs/module/"},next:{title:"Entry point",permalink:"/docs/module/entrypoint"}},d={},s=[{value:"Lifecycle hooks",id:"lifecycle-hooks",level:2},{value:"Inter-module dependency",id:"inter-module-dependency",level:2}],c={toc:s},p="wrapper";function u(e){let{components:n,...t}=e;return(0,a.kt)(p,(0,o.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"defining-modules"},"Defining Modules"),(0,a.kt)("p",null,"The most simple way to define a module is to call ",(0,a.kt)("inlineCode",{parentName:"p"},"createModule")," function."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"const MyModule = createModule({\n  requires: [],   // Other modules that are required by this module\n  components: [], // Component injectable provided by this module\n  factories: [],  // Dynamic injectable provided by this module\n  constants: [],  // Constant injectables provided by this module\n});\n")),(0,a.kt)("p",null,"Usually, you define a module in this way when it only exports injectables."),(0,a.kt)("p",null,"When you need to use some advanced features of module, such as lifecycle hooks, you need to define a module with\ndecorator-style."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"@Module({\n    requires: [],\n    components: [],\n    factories: [],\n    constants: [],\n})\nclass MyModule {\n\n    constructor(@InjectLogger() logger: Logger) {\n      logger.log('Hello from constructor of MyModule');\n    }\n\n    @OnModuleCreated()\n    onModuleCreated(@InjectLogger() logger: Logger) {\n      logger.info('Hello from onModuleCreated of MyModule');\n    }\n}\n")),(0,a.kt)("h2",{id:"lifecycle-hooks"},"Lifecycle hooks"),(0,a.kt)("p",null,"SenseJS defined four lifecycle hooks for modules. Just like the module constructor, the parameters of these lifecycle\nhooks are automatically injected by the framework."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"OnModuleCreated"),"/",(0,a.kt)("inlineCode",{parentName:"p"},"OnModuleDestroy"),": called when the module is created/destroyed, respectively."),(0,a.kt)("p",{parentName:"li"},"When one of your components needs to be initialized and de-initialized(such component must be singleton scoped),\nit shall be done in the ",(0,a.kt)("inlineCode",{parentName:"p"},"@OnModuleCreated")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"@OnModuleDestroy")," hooks of the module that provides the component."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"\n@Component({scope: ComponentScope.SINGLETON})\nexport class DatabaseConnection {\n    async connect() { }\n    async disconnect() { }\n    async query() { }\n}\n\n@Module({components: [DatabaseConnection]})\nexport class DatabaseModule {\n\n    @OnModuleCreated()\n    async onCreated(@Inject(DatabaseConnection) conn) {\n        await conn.connect();\n    }\n\n    @OnModuleDestroy()\n    async onDestroyed(@Inject(DatabaseConnection) conn) {\n        await conn.disconnect();\n    }\n}\n")),(0,a.kt)("p",{parentName:"li"},"So that ",(0,a.kt)("inlineCode",{parentName:"p"},"DatabaseConnection")," is ensured to be connected before it can be used outside of ",(0,a.kt)("inlineCode",{parentName:"p"},"DatabaseModule"),".")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"OnModuleStart"),"/",(0,a.kt)("inlineCode",{parentName:"p"},"OnModuleStop"),": When a module is designed to handle requests, the initialization and\nde-initialization needs to be done in ",(0,a.kt)("inlineCode",{parentName:"p"},"@OnModuleStart")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"@OnModuleStop")," hooks."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"@Module()\nclass TcpEchoServerModule {\n    tcpServer?: net.Server;\n\n    @OnModuleStart()\n    async onCreated() {\n        this.tcpServer = net.createServer((conn)=> conn.pipe(conn)).listen(3000);\n    }\n\n    @OnModuleStop()\n    async onDestroyed() {\n        if (this.tcpServer) {\n            this.tcpServer.close();\n        }\n    }\n}\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"OnModuleStart")," hooks are ensured to be invoked after all ",(0,a.kt)("inlineCode",{parentName:"p"},"OnModuleCreated")," hooks are finished for all modules,\nwhile ",(0,a.kt)("inlineCode",{parentName:"p"},"OnModuleDestroy")," hooks are ensured to be finished before any invocation to ",(0,a.kt)("inlineCode",{parentName:"p"},"OnModuleDestroy")," hooks. This is\nhow SenseJS gracefully startup and shut down your app."),(0,a.kt)("p",{parentName:"li"},"Note that ",(0,a.kt)("inlineCode",{parentName:"p"},"OnModuleStart"),"/",(0,a.kt)("inlineCode",{parentName:"p"},"OnModuleStop")," hooks will be triggered only when the module is started by\n",(0,a.kt)("inlineCode",{parentName:"p"},"ApplicationRunner.start"),"."))),(0,a.kt)("h2",{id:"inter-module-dependency"},"Inter-module dependency"),(0,a.kt)("p",null,"To control the initialization and de-initialization order, you need to specify which one depends on the other ones.\nThis is done by listing the dependent module in ",(0,a.kt)("inlineCode",{parentName:"p"},"requires")," property of the module definition."),(0,a.kt)("p",null,"The following example shows how the need of controlling the initialize order, and how to specify the dependency."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"@Module({\n\n  requires: [DatabaseModule],\n})\nclass SomeFancyModule {\n\n\n  @OnModuleCreated()\n  async onModuleCreated(@Inject(DatabaseConnection) conn: DatabaseConnection) {\n    // Reload state from the database\n    // ...\n  }\n\n  @OnModuleDestroy()\n  async onModuleDestroy(@Inject(DatabaseConnection) conn: DatabaseConnection) {\n    // Persist state to the database\n    // ...\n  }\n}\n")),(0,a.kt)("p",null,"In the above code, ",(0,a.kt)("inlineCode",{parentName:"p"},"SomeFancyModule")," need to inject an instance of ",(0,a.kt)("inlineCode",{parentName:"p"},"DatabaseConnection"),", which is defined in\n",(0,a.kt)("inlineCode",{parentName:"p"},"DatabaseModule"),", during its ",(0,a.kt)("inlineCode",{parentName:"p"},"OnModuleCreated")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"OnModuleDestroy")," hooks. So it is necessary to specify\n",(0,a.kt)("inlineCode",{parentName:"p"},"DatabaseModule")," in ",(0,a.kt)("inlineCode",{parentName:"p"},"requires")," property, otherwise the ",(0,a.kt)("inlineCode",{parentName:"p"},"DatabaseConnection")," may not be available when ",(0,a.kt)("inlineCode",{parentName:"p"},"SomeFancyModule"),"\nis created or destroyed."),(0,a.kt)("p",null,"Note that once a module is initialized, any injectable provided by one module will be available to others, even\ncomponents from the other modules that do not list it as a dependency."),(0,a.kt)("p",null,"In other words, the inter-module dependency graph only affects the order of initialization and de-initialization but\ndoes not restrict you from injecting anything from any other module."),(0,a.kt)("p",null,"Anyway, it is a good practice to explicitly specify the relationship between modules."))}u.isMDXComponent=!0}}]);