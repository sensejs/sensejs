"use strict";(self.webpackChunk_sensejs_sensejs_doc=self.webpackChunk_sensejs_sensejs_doc||[]).push([[777],{4852:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var o=t(9231);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=o.createContext({}),p=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},c=function(e){var n=p(e.components);return o.createElement(s.Provider,{value:n},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},u=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(t),u=r,k=d["".concat(s,".").concat(u)]||d[u]||m[u]||i;return t?o.createElement(k,a(a({ref:n},c),{},{components:t})):o.createElement(k,a({ref:n},c))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,a=new Array(i);a[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[d]="string"==typeof e?e:r,a[1]=l;for(var p=2;p<i;p++)a[p]=t[p];return o.createElement.apply(null,a)}return o.createElement.apply(null,t)}u.displayName="MDXCreateElement"},1753:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var o=t(6e3),r=(t(9231),t(4852));const i={id:"method-invoking",sidebar_position:3},a="\u65b9\u6cd5\u8c03\u7528\u5668",l={unversionedId:"injection/method-invoking",id:"injection/method-invoking",title:"\u65b9\u6cd5\u8c03\u7528\u5668",description:"\u9664\u4e86\u5e94\u7528\u542f\u52a8\u9636\u6bb5\uff0c\u51e0\u4e4e\u6240\u6709\u7684\u4f9d\u8d56\u6ce8\u5165\u90fd\u662f\u7531\u65b9\u6cd5\u8c03\u7528\u5668\u89e6\u53d1\u7684\uff0c\u5bf9\u4e8e\u5b88\u62a4\u8fdb\u7a0b\u7c7b\u5e94\u7528\u800c\u8a00\u5c24\u5176\u5982\u6b64\u3002",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/injection/method-invoker.md",sourceDirName:"injection",slug:"/injection/method-invoking",permalink:"/zh-CN/docs/injection/method-invoking",draft:!1,editUrl:"https://github.com/sensejs/sensejs/edit/master/website/docs/injection/method-invoker.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"method-invoking",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"\u4f9d\u8d56\u6ce8\u5165\u57df",permalink:"/zh-CN/docs/injection/injection-scope"},next:{title:"\u6a21\u5757",permalink:"/zh-CN/docs/module/"}},s={},p=[{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:2},{value:"\u8bf4\u660e",id:"\u8bf4\u660e",level:2}],c={toc:p},d="wrapper";function m(e){let{components:n,...t}=e;return(0,r.kt)(d,(0,o.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u65b9\u6cd5\u8c03\u7528\u5668"},"\u65b9\u6cd5\u8c03\u7528\u5668"),(0,r.kt)("p",null,"\u9664\u4e86\u5e94\u7528\u542f\u52a8\u9636\u6bb5\uff0c\u51e0\u4e4e\u6240\u6709\u7684\u4f9d\u8d56\u6ce8\u5165\u90fd\u662f\u7531\u65b9\u6cd5\u8c03\u7528\u5668\u89e6\u53d1\u7684\uff0c\u5bf9\u4e8e\u5b88\u62a4\u8fdb\u7a0b\u7c7b\u5e94\u7528\u800c\u8a00\u5c24\u5176\u5982\u6b64\u3002"),(0,r.kt)("p",null,"\u6b63\u5982\u4e4b\u524d\u63d0\u5230\u7684\uff0c\u65b9\u6cd5\u8c03\u7528\u5668\u662f SenseJS \u6846\u67b6\u7684\u6838\u5fc3\uff0cSenseJS \u6846\u67b6\u7684\u8bb8\u591a\u529f\u80fd\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e HTTP \u652f\u6301\uff0c\u90fd\u662f\u57fa\u4e8e\u5b83\u7684\u3002"),(0,r.kt)("p",null,"\u672c\u6587\u5c06\u4f1a\u6307\u5bfc\u4f60\u5982\u4f55\u4f7f\u7528\u65b9\u6cd5\u8c03\u7528\u5668\u3002"),(0,r.kt)("h2",{id:"\u793a\u4f8b"},"\u793a\u4f8b"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u4e86\u600e\u6837\u4f7f\u7528\u65b9\u6cd5\u8c03\u7528\u5668\u8c03\u7528\u4e00\u4e2a\u7ec4\u4ef6\u7684\u65b9\u6cd5\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"\nconst symbol1 = Symbol();\nconst symbol2 = Symbol();\n\n@Component()\nclass TargetComponent {\n  targetMethod(\n    @Inject('foobar') foobar: string, // \u5c06\u83b7\u5f97\u5728 FooMiddleware \u63d0\u4f9b\u7684 'FOOBAR'\n    @Inject(symbol1) foo: string,     // \u5c06\u83b7\u5f97\u8c03\u7528 `invoke` \u7684\u7b2c\u4e00\u4e2a\u53c2\u6570 'FOO'\n    @Inject(symbol2) bar: string,     // \u5c06\u83b7\u5f97\u8c03\u7528 `invoke` \u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570 'BAR'\n  ) {\n    console.log(foo, bar, foobar);\n  }\n}\n\n@Middleware({\n  provides: ['foobar']\n})\nclass FooMidlleware {\n  constructor(@Inject(symbol1) private foo: string, @Inject(symbol2) private bar: string) {\n\n  }\n  async handle(next: (foo: string) => Promise<void>) {\n    await next(this.foo + this.bar);\n  }\n}\n\n\n@EntryPoint()\n@Module({\n  components: [TargetComponent]\n})\nclass MyModule {\n\n  timer?: NodeJS.Timer;\n\n  @OnModuleStart()\n  onModuleStart(@Inject(Container) container: Container) {\n\n    this.timer = setInterval(() => {\n\n      container.createMethodInvoker(\n        TagetComponent,\n        'targetMethod',\n        [FooMidlleware], // \u8c03\u7528\u65f6\u4f7f\u7528\u7684\u4e2d\u95f4\u4ef6\n        symbol1, // \u8c03\u7528invoke\u65f6\u901a\u8fc7\u7b2c\u4e00\u4e2a\u53c2\u6570\u63d0\u4f9b\u7684\u53ef\u6ce8\u5165\u5bf9\u8c61\u6240\u7ed1\u5b9a\u7684 id\n        symbol2, // \u8c03\u7528invoke\u65f6\u901a\u8fc7\u7b2c\u4e8c\u4e2a\u53c2\u6570\u63d0\u4f9b\u7684\u53ef\u6ce8\u5165\u5bf9\u8c61\u6240\u7ed1\u5b9a\u7684 id\n      ).invoke(\n        'FOO', // \u5c06\u4f1a\u7ed1\u5b9a\u5230 `symbol1`\n        'BAR', // \u5c06\u4f1a\u7ed1\u5b9a\u5230 `symbol2`\n      );\n    }, 1000);\n  }\n\n  @OnModuleStop()\n  onModuleStop() {\n    if (this.timer) {\n      clearInterval(this.timer);\n    }\n  }\n\n}\n")),(0,r.kt)("h2",{id:"\u8bf4\u660e"},"\u8bf4\u660e"),(0,r.kt)("p",null,"\u5728\u793a\u4f8b\u7684\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6a21\u5757 ",(0,r.kt)("inlineCode",{parentName:"p"},"MyModule"),"\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u7ec4\u4ef6 ",(0,r.kt)("inlineCode",{parentName:"p"},"TargetComponent"),"\u3002"),(0,r.kt)("p",null,"\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"MyModule")," \u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"OnModuleStart")," \u94a9\u5b50\u4e2d\uff0c\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5b9a\u65f6\u901a\u8fc7\u65b9\u6cd5\u8c03\u7528\u5668\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"TargetComponent")," \u7684\n",(0,r.kt)("inlineCode",{parentName:"p"},"targetMethod")," \u65b9\u6cd5\uff0c\u8c03\u7528\u65f6\u63d0\u4f9b\u4e86\u989d\u5916\u7684\u53ef\u6ce8\u5165\u5bf9\u8c61\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u7ed1\u5b9a\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},'"foobar"')," \u7684\u53ef\u6ce8\u5165\u5bf9\u8c61\u7531\u4e2d\u95f4\u4ef6 ",(0,r.kt)("inlineCode",{parentName:"p"},"FooMiddleware")," \u63d0\u4f9b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u7ed1\u5b9a\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"symbol1")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"symbol2")," \u7684\u53ef\u6ce8\u5165\u5bf9\u8c61\u7531 ",(0,r.kt)("inlineCode",{parentName:"p"},"invoke")," \u65b9\u6cd5\u7684\u53c2\u6570\u63d0\u4f9b"))),(0,r.kt)("p",null,"\u6ce8\u610f\u5230\uff0c\u8fd9\u4e9b\u53ef\u6ce8\u5165\u5bf9\u8c61\u6ca1\u6709\u5728\u5176\u4ed6\u5730\u65b9\u5b9a\u4e49\uff0c\u5b83\u4eec\u4ec5\u5728\u6b64\u6b21\u65b9\u6cd5\u8c03\u7528\u7684\u4f1a\u8bdd\u4e2d\u6709\u6548\u3002"),(0,r.kt)("p",null,"\u5373\u4f7f\u5b83\u4eec\u5728\u5176\u4ed6\u5730\u65b9\u5b9a\u4e49\u4e86\uff0c\u8c03\u7528\u65f6\u63d0\u4f9b\u7684\u503c\u4e5f\u4f1a\u8986\u76d6\u5b9a\u4e49\u7684\u503c\u3002"),(0,r.kt)("p",null,"\u53e6\u5916\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"this.container.createMethodInvoker().invoke()")," \u4f1a\u542f\u52a8\u4e00\u4e2a\u65b0\u7684\u4f9d\u8d56\u6ce8\u5165\u4f1a\u8bdd\uff0c\u8fd9\u610f\u5473\u7740 ",(0,r.kt)("inlineCode",{parentName:"p"},"Scope.SESSION")," \u7684\n\u53ef\u6ce8\u5165\u5bf9\u8c61\u6bcf\u6b21\u90fd\u4f1a\u88ab\u91cd\u65b0\u5b9e\u4f8b\u5316\u3002"))}m.isMDXComponent=!0}}]);