"use strict";(self.webpackChunk_sensejs_sensejs_doc=self.webpackChunk_sensejs_sensejs_doc||[]).push([[710],{5046:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>u,frontMatter:()=>d,metadata:()=>r,toc:()=>i});var s=o(5250),c=o(9074);const d={id:"defining-modules",sidebar_position:1},t="\u5b9a\u4e49\u6a21\u5757",r={id:"module/defining-modules",title:"\u5b9a\u4e49\u6a21\u5757",description:"\u6700\u7b80\u5355\u7684\u5b9a\u4e49\u4e00\u4e2a\u6a21\u5757\u7684\u65b9\u5f0f\u662f\u8c03\u7528 createModule \u51fd\u6570\u3002",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/module/defining-modules.md",sourceDirName:"module",slug:"/module/defining-modules",permalink:"/zh-CN/docs/module/defining-modules",draft:!1,unlisted:!1,editUrl:"https://github.com/sensejs/sensejs/edit/master/website/docs/module/defining-modules.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"defining-modules",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"\u6a21\u5757",permalink:"/zh-CN/docs/module/"},next:{title:"\u5165\u53e3\u70b9",permalink:"/zh-CN/docs/module/entrypoint"}},l={},i=[{value:"\u751f\u547d\u5468\u671f\u94a9\u5b50",id:"\u751f\u547d\u5468\u671f\u94a9\u5b50",level:2},{value:"\u6a21\u5757\u95f4\u4f9d\u8d56\u5173\u7cfb",id:"\u6a21\u5757\u95f4\u4f9d\u8d56\u5173\u7cfb",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"\u5b9a\u4e49\u6a21\u5757",children:"\u5b9a\u4e49\u6a21\u5757"}),"\n",(0,s.jsxs)(n.p,{children:["\u6700\u7b80\u5355\u7684\u5b9a\u4e49\u4e00\u4e2a\u6a21\u5757\u7684\u65b9\u5f0f\u662f\u8c03\u7528 ",(0,s.jsx)(n.code,{children:"createModule"})," \u51fd\u6570\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const MyModule = createModule({\n  requires: [],   // \u672c\u6a21\u5757\u6240\u4f9d\u8d56\u7684\u5176\u4ed6\u6a21\u5757\n  components: [], // \u672c\u6a21\u5757\u63d0\u4f9b\u7684\u7ec4\u4ef6\n  factories: [],  // \u672c\u6a21\u5757\u63d0\u4f9b\u7684\u6709\u5de5\u5382\u63d0\u4f9b\u7684\u53ef\u6ce8\u5165\u5bf9\u8c61\n  constants: [],  // \u672c\u6a21\u5757\u63d0\u4f9b\u7684\u5e38\u91cf\u53ef\u6ce8\u5165\u5bf9\u8c61\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u901a\u5e38\uff0c\u5728\u9700\u8981\u4e00\u4e2a\u4ec5\u5bfc\u51fa\u53ef\u6ce8\u5165\u5bf9\u8c61\u7684\u6a21\u5757\u65f6\uff0c\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u5b9a\u4e49\u6a21\u5757"}),"\n",(0,s.jsx)(n.p,{children:"\u5f53\u4f60\u9700\u8981\u4f7f\u7528\u6a21\u5757\u7684\u9ad8\u7ea7\u7279\u6027\uff0c\u4f8b\u5982\u751f\u547d\u5468\u671f\u94a9\u5b50\u65f6\uff0c\u4f60\u9700\u8981\u4f7f\u7528\u88c5\u9970\u5668\u98ce\u683c\u5b9a\u4e49\u6a21\u5757\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@Module({\n    requires: [],\n    components: [],\n    factories: [],\n    constants: [],\n})\nclass MyModule {\n\n    constructor(@InjectLogger() logger: Logger) {\n      logger.log('Hello from constructor of MyModule');\n    }\n\n    @OnModuleCreated()\n    onModuleCreated(@InjectLogger() logger: Logger) {\n      logger.info('Hello from onModuleCreated of MyModule');\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u751f\u547d\u5468\u671f\u94a9\u5b50",children:"\u751f\u547d\u5468\u671f\u94a9\u5b50"}),"\n",(0,s.jsx)(n.p,{children:"SenseJS \u4e3a\u6a21\u5757\u5b9a\u4e49\u4e86\u56db\u4e2a\u751f\u547d\u5468\u671f\u94a9\u5b50\u3002\u5c31\u50cf\u6a21\u5757\u6784\u9020\u51fd\u6570\u4e00\u6837\uff0c\u8fd9\u4e9b\u751f\u547d\u5468\u671f\u94a9\u5b50\u7684\u53c2\u6570\u4e5f\u662f\u7531\u6846\u67b6\u81ea\u52a8\u6ce8\u5165\u7684\u3002"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"OnModuleCreated"}),"/",(0,s.jsx)(n.code,{children:"OnModuleDestroy"}),": \u5f53\u6a21\u5757\u88ab\u521b\u5efa\u548c\u9500\u6bc1\u65f6\u5206\u522b\u88ab\u8c03\u7528"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5f53\u4f60\u7684\u7ec4\u4ef6\u9700\u8981\u521d\u59cb\u5316\u548c\u9500\u6bc1\u65f6\uff08\u8fd9\u6837\u7684\u7ec4\u4ef6\u5fc5\u987b\u662f\u5355\u4f8b\u4f5c\u7528\u57df\u7684\uff09\uff0c\u5e94\u8be5\u5728\u63d0\u4f9b\u8be5\u7ec4\u4ef6\u7684\u6a21\u5757\u7684 ",(0,s.jsx)(n.code,{children:"@OnModuleCreated"}),"\n\u548c ",(0,s.jsx)(n.code,{children:"@OnModuleDestroy"})," \u94a9\u5b50\u4e2d\u5b8c\u6210\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"\n@Component({scope: ComponentScope.SINGLETON})\nexport class DatabaseConnection {\n    async connect() { }\n    async disconnect() { }\n    async query() { }\n}\n\n@Module({components: [DatabaseConnection]})\nexport class DatabaseModule {\n\n    @OnModuleCreated()\n    async onCreated(@Inject(DatabaseConnection) conn) {\n        await conn.connect();\n    }\n\n    @OnModuleDestroy()\n    async onDestroyed(@Inject(DatabaseConnection) conn) {\n        await conn.disconnect();\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u8fd9\u6837\u786e\u4fdd\u4e86 ",(0,s.jsx)(n.code,{children:"DatabaseConnection"})," \u5728\u80fd\u88ab\u5176\u4ed6\u6a21\u5757\u4f7f\u7528\u4e4b\u524d\uff0c\u5df2\u7ecf\u8fde\u63a5\u597d\u4e86\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"OnModuleStart"}),"/",(0,s.jsx)(n.code,{children:"OnModuleStop"}),": \u5f53\u4e00\u4e2a\u6a21\u5757\u88ab\u8bbe\u8ba1\u7528\u6765\u5904\u7406\u8bf7\u6c42\u65f6\uff0c\u5bf9\u5e94\u7684\u521d\u59cb\u5316\u548c\u9500\u6bc1\u64cd\u4f5c\u5e94\u8be5\u5206\u522b\u5728 ",(0,s.jsx)(n.code,{children:"@OnModuleStart"}),"\n\u548c ",(0,s.jsx)(n.code,{children:"@OnModuleStop"})," \u4e2d\u8fdb\u884c\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@Module()\nclass TcpEchoServerModule {\n    tcpServer?: net.Server;\n\n    @OnModuleStart()\n    async onCreated() {\n        this.tcpServer = net.createServer((conn)=> conn.pipe(conn)).listen(3000);\n    }\n\n    @OnModuleStop()\n    async onDestroyed() {\n        if (this.tcpServer) {\n            this.tcpServer.close();\n        }\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"OnModuleStart"})," \u94a9\u5b50\u88ab\u786e\u4fdd\u5728\u6240\u6709\u6a21\u5757\u7684 ",(0,s.jsx)(n.code,{children:"OnModuleCreated"})," \u94a9\u5b50\u6267\u884c\u5b8c\u6bd5\u540e\u88ab\u8c03\u7528\uff0c\u800c ",(0,s.jsx)(n.code,{children:"OnModuleStop"}),"\n\u94a9\u5b50\u88ab\u786e\u4fdd\u5728\u4efb\u4e00\u6a21\u5757\u7684 ",(0,s.jsx)(n.code,{children:"OnModuleDestroy"})," \u94a9\u5b50\u6267\u884c\u524d\u88ab\u8c03\u7528\u5b8c\u6bd5\u3002\u8fd9\u5c31\u662f SenseJS \u5982\u4f55\u4f18\u96c5\u5730\u542f\u52a8\u548c\u5173\u95ed\u4f60\u7684\u5e94\u7528\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u800c ",(0,s.jsx)(n.code,{children:"OnModuleStart"})," \u548c ",(0,s.jsx)(n.code,{children:"OnModuleStop"})," \u4ec5\u5728\u5e94\u7528\u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"ApplicationRunner.start"}),"\n\u7684\u65b9\u5f0f\u542f\u52a8\u65f6\u624d\u4f1a\u88ab\u8c03\u7528\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u6a21\u5757\u95f4\u4f9d\u8d56\u5173\u7cfb",children:"\u6a21\u5757\u95f4\u4f9d\u8d56\u5173\u7cfb"}),"\n",(0,s.jsx)(n.p,{children:"\u8981\u63a7\u5236\u6a21\u5757\u7684\u521d\u59cb\u5316\u548c\u9500\u6bc1\u987a\u5e8f\uff0c\u4f60\u9700\u8981\u6307\u5b9a\u54ea\u4e9b\u6a21\u5757\u4f9d\u8d56\u4e8e\u5176\u4ed6\u6a21\u5757\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u4e00\u4e2a\u6a21\u5757\u7684\u6240\u6709\u4f9d\u8d56\u53ef\u4ee5\u5728\u5b9a\u4e49\u6a21\u5757\u65f6\u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"requires"})," \u5c5e\u6027\u4e2d\u6307\u5b9a\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u4e0b\u9762\u7684\u4f8b\u5b50\u5c55\u793a\u4e86\u9700\u8981\u63a7\u5236\u521d\u59cb\u5316\u987a\u5e8f\u7684\u573a\u666f\uff0c\u4ee5\u53ca\u5982\u4f55\u6307\u5b9a\u4f9d\u8d56\u5173\u7cfb\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@Module({\n\n  requires: [DatabaseModule],\n})\nclass SomeFancyModule {\n\n\n  @OnModuleCreated()\n  async onModuleCreated(@Inject(DatabaseConnection) conn: DatabaseConnection) {\n    // \u4ece\u6570\u636e\u5e93\u4e2d\u6062\u590d\u72b6\u6001\n    // ...\n  }\n\n  @OnModuleDestroy()\n  async onModuleDestroy(@Inject(DatabaseConnection) conn: DatabaseConnection) {\n    // \u5411\u6570\u636e\u5e93\u4e2d\u4fdd\u5b58\u72b6\u6001\n    // ...\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c",(0,s.jsx)(n.code,{children:"SomeFancyModule"})," \u9700\u8981\u5728\u5176 ",(0,s.jsx)(n.code,{children:"OnModuleCreated"})," \u548c ",(0,s.jsx)(n.code,{children:"OnModuleDestroy"})," \u94a9\u5b50\u4e2d\u6ce8\u5165\u4e00\u4e2a\n",(0,s.jsx)(n.code,{children:"DatabaseConnection"}),"\uff0c\u800c ",(0,s.jsx)(n.code,{children:"DatabaseConnection"})," \u662f\u5728 ",(0,s.jsx)(n.code,{children:"DatabaseModule"})," \u4e2d\u5b9a\u4e49\u7684\u3002\u56e0\u6b64\uff0c\u9700\u8981\u5728 ",(0,s.jsx)(n.code,{children:"requires"})," \u5c5e\u6027\u4e2d\u5217\u51fa\n",(0,s.jsx)(n.code,{children:"DatabaseModule"}),"\uff0c\u5426\u5219\u5728 ",(0,s.jsx)(n.code,{children:"SomeFancyModule"})," \u88ab\u521b\u5efa\u6216\u9500\u6bc1\u65f6\uff0c",(0,s.jsx)(n.code,{children:"DatabaseConnection"})," \u53ef\u80fd\u8fd8\u4e0d\u53ef\u7528\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u4e00\u65e6\u4e00\u4e2a\u6a21\u5757\u5b8c\u6210\u4e86\u521d\u59cb\u5316\uff0c\u4efb\u4f55\u5176\u4ed6\u6a21\u5757\u90fd\u53ef\u4ee5\u6ce8\u5165\u8be5\u6a21\u5757\u63d0\u4f9b\u7684\u4efb\u4f55\u53ef\u6ce8\u5165\u5bf9\u8c61\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u6362\u53e5\u8bdd\u8bf4\uff0c\u6a21\u5757\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\u4ec5\u5f71\u54cd\u521d\u59cb\u5316\u548c\u9500\u6bc1\u7684\u987a\u5e8f\uff0c\u5e76\u4e0d\u4f1a\u9650\u5236\u4f60\u4ece\u5176\u4ed6\u6a21\u5757\u6ce8\u5165\u4efb\u4f55\u5bf9\u8c61\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u4f46\u65e0\u8bba\u5982\u4f55\uff0c\u663e\u5f0f\u6307\u5b9a\u6a21\u5757\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\u662f\u4e00\u4e2a\u597d\u7684\u5b9e\u8df5\u3002"})]})}function u(e={}){const{wrapper:n}={...(0,c.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},9074:(e,n,o)=>{o.d(n,{Z:()=>r,a:()=>t});var s=o(79);const c={},d=s.createContext(c);function t(e){const n=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),s.createElement(d.Provider,{value:n},e.children)}}}]);